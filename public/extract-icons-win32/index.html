<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Extract extra large icon from a file, folder or drive - home/lluisfranco/code/tips/</title>
        <meta name="Description" content="home/lluisfranco/code/tips/"><meta property="og:title" content="Extract extra large icon from a file, folder or drive" />
<meta property="og:description" content="Extracting system icons from Win32 Overwiew Hi, everyone! :)
In a recent project I was required to show a list of files with their associated icons. This task sounds quite easy, and in fact it is… Except if you have to deal with files in network paths or you want to get different icons sizes, apart the typical 32×32.
You can achieve this using managed code (the easy way), using the static method ExtractAssociatedIcon in the class System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://lluisfranco.com/extract-icons-win32/" />
<meta property="article:published_time" content="2019-04-16T11:51:50+02:00" />
<meta property="article:modified_time" content="2019-04-16T11:51:50+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Extract extra large icon from a file, folder or drive"/>
<meta name="twitter:description" content="Extracting system icons from Win32 Overwiew Hi, everyone! :)
In a recent project I was required to show a list of files with their associated icons. This task sounds quite easy, and in fact it is… Except if you have to deal with files in network paths or you want to get different icons sizes, apart the typical 32×32.
You can achieve this using managed code (the easy way), using the static method ExtractAssociatedIcon in the class System."/>
<meta name="application-name" content="home/lluisfranco/code/tips/">
<meta name="apple-mobile-web-app-title" content="home/lluisfranco/code/tips/"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/images/myAvatar.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://lluisfranco.com/extract-icons-win32/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Extract extra large icon from a file, folder or drive",
        "inLanguage": "en-us",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/lluisfranco.com\/extract-icons-win32\/"
        },"image": {
                "@type": "ImageObject",
                "url": "http:\/\/lluisfranco.com\/images\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "c#, API, Win32","wordcount":  780 ,
        "url": "http:\/\/lluisfranco.com\/extract-icons-win32\/","datePublished": "2019-04-16T11:51:50+02:00","dateModified": "2019-04-16T11:51:50+02:00","publisher": {
                "@type": "Organization",
                "name": "Lluis Franco",
                "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/lluisfranco.com\/images\/avatar200.png",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "lluis"
            },"description": ""
    }
    </script></head>
    <body><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="home/lluisfranco/code/tips/"><span class="header-title-pre"><i class='fab fa-discourse'></i></span>Lluis Franco</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="home/lluisfranco/code/tips/"><span class="header-title-pre"><i class='fab fa-discourse'></i></span>Lluis Franco</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Extract extra large icon from a file, folder or drive</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>lluis</a></span>&nbsp;
                    <span class="post-category">included in<a href="/categories/development/">
                                <i class="far fa-folder fa-fw"></i>Development
                            </a>&nbsp;<a href="/categories/how-to/">
                                <i class="far fa-folder fa-fw"></i>How To
                            </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-04-16>2019-04-16</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>about 780 words&nbsp;
                <i class="far fa-clock fa-fw"></i>4 min&nbsp;</div>
        </div><div class="details toc" id="toc-static">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#extracting-system-icons-from-win32">Extracting system icons from Win32</a>
      <ul>
        <li><a href="#overwiew">Overwiew</a></li>
        <li><a href="#show-me-the-code">Show me the code</a>
          <ul>
            <li><a href="#the-final-solution">The final solution</a></li>
            <li><a href="#the-ingredients">The ingredients</a></li>
            <li><a href="#putting-it-all-together">Putting it all together</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="extracting-system-icons-from-win32">Extracting system icons from Win32</h2>
<h3 id="overwiew">Overwiew</h3>
<p>Hi, everyone! :)</p>
<p>In a recent project I was required to show a list of files with their associated icons. This task sounds quite easy, and in fact it is… Except if you have to deal with files in network paths or you want to get different icons sizes, apart the typical 32×32.</p>
<p><img
        class="lazyload"
        src="/svg/loading/small.min.svg"
        data-src="/images/posts/extract_icons_win32.png"
        data-srcset="/images/posts/extract_icons_win32.png, /images/posts/extract_icons_win32.png 1.5x, /images/posts/extract_icons_win32.png 2x"
        data-sizes="auto"
        alt="some extra large icons"
        title="some extra large icons" /></p>
<p>You can achieve this using managed code (the easy way), using the static method <a href="http://msdn.microsoft.com/en-us/library/vstudio/system.drawing.icon.extractassociatedicon" target="_blank" rel="noopener noreffer">ExtractAssociatedIcon</a> in the class System.Drawing.Icon, but sadly this method doesn’t work with UNC (Universal Naming Convention) paths nor return other sizes that 32×32 pixels.</p>
<p>I had to show four different icons sizes including the extra-large icon, also called “jumbo”, so I’ve decided to use some functions and structures from the Win32 API. Of course, if anyone knows a better way to do it, please contact with me ASAP :)</p>
<h3 id="show-me-the-code">Show me the code</h3>
<p>Before starting, let’s take a look to the final code:</p>
<h4 id="the-final-solution">The final solution</h4>
<p>From a file path and the desired size we&rsquo;ll retrieve the associated icon.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="hl"><span class="lnt">3
</span></span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">filename</span> <span class="p">=</span> <span class="s">&#34;\\myNetworkResource\Folder\SampleDocument.pdf&#34;</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">size</span> <span class="p">=</span> <span class="n">IconSizeEnum</span><span class="p">.</span><span class="n">ExtraLargeIcon</span><span class="p">;</span>
<span class="hl"><span class="kt">var</span> <span class="n">image</span> <span class="p">=</span> <span class="n">GetBitmapFromFilePath</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="the-ingredients">The ingredients</h4>
<p>API functions and structures (TODO)</p>
<p>SHGetFileInfoA FUNCTION</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="na">[DllImport(&#34;shell32.dll&#34;, SetLastError=true)]</span>
<span class="k">static</span> <span class="k">extern</span> <span class="n">TODO</span> <span class="n">SHGetFileInfoA</span><span class="p">(</span><span class="n">TODO</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div>
<p>_SHFILEINFOA STRUCTURE</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="n">typedef</span> <span class="k">struct</span> <span class="nc">_SHFILEINFOA</span> <span class="p">{</span>
  <span class="n">HICON</span> <span class="n">hIcon</span><span class="p">;</span>
  <span class="kt">int</span>   <span class="n">iIcon</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">dwAttributes</span><span class="p">;</span>
  <span class="n">CHAR</span>  <span class="n">szDisplayName</span><span class="p">[</span><span class="n">MAX_PATH</span><span class="p">];</span>
  <span class="n">CHAR</span>  <span class="n">szTypeName</span><span class="p">[</span><span class="m">80</span><span class="p">];</span>
<span class="p">}</span> <span class="n">SHFILEINFOA</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div>
<p>SHGetImageList FUNCTION</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="na">[DllImport(&#34;shell32.dll&#34;, EntryPoint = &#34;#727&#34;)]</span>
<span class="k">private</span> <span class="k">extern</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">SHGetImageList</span><span class="p">(</span><span class="kt">int</span> <span class="n">iImageList</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Guid</span> <span class="n">riid</span><span class="p">,</span> <span class="k">ref</span> <span class="n">IImageList</span> <span class="n">ppv</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div>
<h4 id="putting-it-all-together">Putting it all together</h4>
<p>In this code we’re using several API calls. Here’s the tricky part:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="hl"><span class="lnt"> 9
</span></span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="hl"><span class="lnt">15
</span></span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">static</span> <span class="n">IntPtr</span> <span class="n">GetIconHandleFromFilePath</span><span class="p">(</span>
    <span class="kt">string</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">IconSizeEnum</span> <span class="n">iconsize</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">shinfo</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Shell</span><span class="p">.</span><span class="n">SHFILEINFO</span><span class="p">();</span>
    <span class="k">const</span> <span class="kt">uint</span> <span class="n">SHGFI_SYSICONINDEX</span> <span class="p">=</span> <span class="m">0</span><span class="n">x4000</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">FILE_ATTRIBUTE_NORMAL</span> <span class="p">=</span> <span class="m">0</span><span class="n">x80</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">int</span> <span class="n">ILD_TRANSPARENT</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">flags</span> <span class="p">=</span> <span class="n">SHGFI_SYSICONINDEX</span><span class="p">;</span>
<span class="hl">    <span class="kt">var</span> <span class="n">retval</span> <span class="p">=</span> <span class="n">SHGetFileInfo</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span>
</span>        <span class="k">ref</span> <span class="n">shinfo</span><span class="p">,</span> <span class="n">Marshal</span><span class="p">.</span><span class="n">SizeOf</span><span class="p">(</span><span class="n">shinfo</span><span class="p">),</span> <span class="n">flags</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retval</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="k">throw</span> <span class="p">(</span><span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">FileNotFoundException</span><span class="p">());</span>
    <span class="kt">var</span> <span class="n">iconIndex</span> <span class="p">=</span> <span class="n">shinfo</span><span class="p">.</span><span class="n">iIcon</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">iImageListGuid</span> <span class="p">=</span> <span class="n">newGuid</span><span class="p">(</span><span class="s">&#34;46EB5926-582E-4017-9FDF-E8998DAA0950&#34;</span><span class="p">);</span>
    <span class="n">Shell</span><span class="p">.</span><span class="n">IImageList</span> <span class="n">iml</span><span class="p">;</span>
<span class="hl">    <span class="kt">var</span> <span class="n">hres</span> <span class="p">=</span> <span class="n">SHGetImageList</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">iconsize</span><span class="p">,</span> <span class="k">ref</span> <span class="n">iImageListGuid</span><span class="p">,</span> <span class="k">out</span> <span class="n">iml</span><span class="p">);</span>
</span>    <span class="kt">var</span> <span class="n">hIcon</span> <span class="p">=</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">;</span>
    <span class="n">hres</span> <span class="p">=</span> <span class="n">iml</span><span class="p">.</span><span class="n">GetIcon</span><span class="p">(</span><span class="n">iconIndex</span><span class="p">,</span> <span class="n">ILD_TRANSPARENT</span><span class="p">,</span> <span class="k">ref</span> <span class="n">hIcon</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">hIcon</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>First, we need to make call to the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb762179%28v=vs.85%29.aspx" target="_blank" rel="noopener noreffer">SHGetFileInfo</a> function that receives a reference to a structure of type <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb759792%28v=vs.85%29.aspx" target="_blank" rel="noopener noreffer">SHFILEINFO</a>, which contains the index of the icon image within the system image list. We will use this index later.</p>
<p>Then we’ve to make is a second call to the <a href="http://www.pinvoke.net/default.aspx/shell32.shgetimagelist" target="_blank" rel="noopener noreffer">SHGetImageList</a> function that receives an output parameter with an <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb761490%28v=vs.85%29.aspx" target="_blank" rel="noopener noreffer">IImageList</a> structure, which is modified within the function.</p>
<p>This struct retrieve a COM interface and we need to keep in mind a couple of things:</p>
<p>a) We must use the GUID of this interface in the declaration:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="na">[ComImportAttribute()]</span>
<span class="na">[GuidAttribute(“46EB5926-582E-4017-9FDF-E8998DAA0950”)]</span>
<span class="na">[InterfaceTypeAttribute(ComInterfaceType.InterfaceIsIUnknown)]</span>
</code></pre></td></tr></table>
</div>
</div>
<p>b) And in the improbable case you are going to deploy your project over XP, remember that SHGetImageList <a href="http://support.microsoft.com/default.aspx?scid=kb;EN-US;Q316931" target="_blank" rel="noopener noreffer">is not exported correctly in XP</a>. For this reason you must hardcode the function’s entry point. Apparently (and hopefully) ordinal 727 isn’t going to change…</p>
<p>Once we have that COM interface, we only need to call its <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb761463%28v=vs.85%29.aspx" target="_blank" rel="noopener noreffer">GetIcon</a> method, passing a parameter with the desired size, and obtaining a handle to the icon by reference.</p>
<p>After having the handle its really simple create an Icon from the handle, and then convert to a Bitmap, BitmapSource or other:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="hl"><span class="lnt"> 4
</span></span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">static</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Bitmap</span> <span class="n">GetBitmapFromFilePath</span><span class="p">(</span>
 <span class="kt">string</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">IconSizeEnum</span> <span class="n">iconsize</span><span class="p">)</span>
<span class="p">{</span>
<span class="hl">    <span class="n">IntPtr</span> <span class="n">hIcon</span> <span class="p">=</span> <span class="n">GetIconHandleFromFilePath</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">iconsize</span><span class="p">);</span>
</span>    <span class="kt">var</span> <span class="n">myIcon</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Icon</span><span class="p">.</span><span class="n">FromHandle</span><span class="p">(</span><span class="n">hIcon</span><span class="p">);</span>
    <span class="kt">var</span> <span class="n">bitmap</span> <span class="p">=</span> <span class="n">myIcon</span><span class="p">.</span><span class="n">ToBitmap</span><span class="p">();</span>
    <span class="n">myIcon</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
    <span class="n">DestroyIcon</span><span class="p">(</span><span class="n">hIcon</span><span class="p">);</span>
    <span class="n">SendMessage</span><span class="p">(</span><span class="n">hIcon</span><span class="p">,</span> <span class="n">WM_CLOSE</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">,</span> <span class="n">IntPtr</span><span class="p">.</span><span class="n">Zero</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">bitmap</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>Tip: It’s very important don’t forget to destroy the resources (Icon) when working with the Win32 API!</p>
</blockquote>
<p>This method calls the previous one, obtains the icon’s handle and then creates the icon using the handle. Then creates a bitmap from the icon, destroys the icon and returns the bitmap.</p>
<p>I’ve also created an enumeration IconSizeEnum with the different flags values as well:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">SHGFI_SMALLICON</span> <span class="p">=</span> <span class="m">0</span><span class="n">x1</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">SHGFI_LARGEICON</span> <span class="p">=</span> <span class="m">0</span><span class="n">x0</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">SHIL_JUMBO</span> <span class="p">=</span> <span class="m">0</span><span class="n">x4</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">SHIL_EXTRALARGE</span> <span class="p">=</span> <span class="m">0</span><span class="n">x2</span><span class="p">;</span>
<span class="k">private</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">WM_CLOSE</span> <span class="p">=</span> <span class="m">0</span><span class="n">x0010</span><span class="p">;</span>

<span class="k">public</span> <span class="k">enum</span> <span class="n">IconSizeEnum</span>
<span class="p">{</span>
    <span class="n">SmallIcon16</span> <span class="p">=</span> <span class="n">SHGFI_SMALLICON</span><span class="p">,</span>
    <span class="n">MediumIcon32</span> <span class="p">=</span> <span class="n">SHGFI_LARGEICON</span><span class="p">,</span>
    <span class="n">LargeIcon48</span> <span class="p">=</span> <span class="n">SHIL_EXTRALARGE</span><span class="p">,</span>
    <span class="n">ExtraLargeIcon</span> <span class="p">=</span> <span class="n">SHIL_JUMBO</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p>Finally, retrieving the icon from a file path it’s as easy as:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csharp" data-lang="csharp"><span class="kt">var</span> <span class="n">size</span> <span class="p">=</span> <span class="n">ShellEx</span><span class="p">.</span><span class="n">IconSizeEnum</span><span class="p">.</span><span class="n">ExtraLargeIcon</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">ofd</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OpenFileDialog</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ofd</span><span class="p">.</span><span class="n">ShowDialog</span><span class="p">()</span> <span class="p">==</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Forms</span><span class="p">.</span><span class="n">DialogResult</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">labelFilePath</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">ofd</span><span class="p">.</span><span class="n">FileName</span><span class="p">;</span>
    <span class="n">pictureBox1</span><span class="p">.</span><span class="n">Image</span> <span class="p">=</span> <span class="n">ShellEx</span><span class="p">.</span><span class="n">GetBitmapFromFilePath</span><span class="p">(</span><span class="n">ofd</span><span class="p">.</span><span class="n">FileName</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>You can also use UNC paths, including network paths :)</p>
</blockquote>
<p>Hope this helps! ;)</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>The article was updated on 2019-04-16</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/extract-icons-win32/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://lluisfranco.com/extract-icons-win32/" data-title="Extract extra large icon from a file, folder or drive" data-via="lluisfranco" data-hashtags="c#,API,Win32"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://lluisfranco.com/extract-icons-win32/" data-hashtag="c#"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="http://lluisfranco.com/extract-icons-win32/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="http://lluisfranco.com/extract-icons-win32/" data-title="Extract extra large icon from a file, folder or drive" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Pinterest" data-sharer="pinterest" data-url="http://lluisfranco.com/extract-icons-win32/"><i class="fab fa-pinterest fa-fw"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="http://lluisfranco.com/extract-icons-win32/"><i class="fab fa-reddit fa-fw"></i></a><a href="javascript:void(0);" title="Share on Instapaper" data-sharer="instapaper" data-url="http://lluisfranco.com/extract-icons-win32/" data-title="Extract extra large icon from a file, folder or drive" data-description=""><i data-svg-src="/lib/simple-icons/icons/instapaper.min.svg"></i></a><a href="javascript:void(0);" title="Share on Pocket" data-sharer="pocket" data-url="http://lluisfranco.com/extract-icons-win32/"><i class="fab fa-get-pocket fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="http://lluisfranco.com/extract-icons-win32/" data-title="Extract extra large icon from a file, folder or drive"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=""></a>,&nbsp;<a href="/tags/api/">API</a>,&nbsp;<a href="/tags/win32/">Win32</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"></div>
</div>
<div id="comments"></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2019 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Lluís Franco</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript">
    window.config = {"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"headerMode":{"desktop":"fixed","mobile":"auto"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"lunrIndexURL":"/index.json","noResultsFound":"No results found","type":"lunr"}};
</script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=Element.prototype.closest%2CrequestAnimationFrame%2CCustomEvent%2CPromise%2CObject.entries%2CObject.assign%2CObject.values%2Cfetch%2CElement.prototype.after%2CArray.prototype.fill%2CIntersectionObserver%2CArray.from%2CArray.prototype.find%2CMath.sign"></script><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/object-fit-images/ofi.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
